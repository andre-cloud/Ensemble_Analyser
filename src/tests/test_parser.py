import numpy as np
from mock import Mock, patch


from src.parser_parameter import get_opt_geometry


def test_get_geom():
    with open("tests/assets/protocol_1.out") as f:
        fl = f.read()

    exp_geom = np.array(
        [
            [0.10927, 0.750046, 0.429949],
            [-0.450809, 2.016541, 0.619739],
            [-1.794074, 2.223156, 0.301106],
            [-2.579856, 1.191188, -0.200356],
            [-2.008682, -0.069666, -0.386467],
            [-0.675235, -0.294482, -0.075681],
            [1.406902, 0.43245, 0.706185],
            [0.137906, 2.839229, 1.00898],
            [-2.222953, 3.210363, 0.451727],
            [-3.623795, 1.363123, -0.444343],
            [-2.608832, -0.886901, -0.777723],
            [-0.222689, -1.271917, -0.217315],
            [2.246865, 1.46915, 1.229078],
            [2.336517, 2.301195, 0.520007],
            [3.224972, 1.010045, 1.379027],
            [1.864795, 1.84078, 2.187788],
        ]
    )

    assert np.allclose(get_opt_geometry(fl, "orca", Mock()), exp_geom)
